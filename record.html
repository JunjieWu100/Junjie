<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Style the buttons */
      button {
        padding: 15px 30px;
        font-size: 18px;
        margin: 10px;
        cursor: pointer;
      }

      /* Style the audio playback */
      audio {
        margin-top: 20px;
        width: 100%;
      }

      /* Center the content */
      body {
        text-align: center;
        font-family: Arial, sans-serif;
      }

      #status {
        font-size: 16px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h2>Record and Play Audio</h2>

    <!-- Start and Stop buttons for recording -->
    <button id="start">Start Recording</button>
    <button id="stop">Stop Recording</button>

    <!-- Status message -->
    <p id="status">Press "Start Recording" to begin</p>

    <!-- Audio element for playback -->
    <audio id="audioPlayback" controls></audio>

    <!-- Download button (appears after recording) -->
    <a id="download" href="#" download="recorded_audio.wav" style="display:none;">
      <button>Download Audio</button>
    </a>

    <!-- Button for user to explicitly play the recorded audio -->
    <button id="playAudio" style="display:none;">Play Recorded Audio</button>

    <script>
      let mediaRecorder;
      let audioChunks = [];

      const startButton = document.getElementById('start');
      const stopButton = document.getElementById('stop');
      const statusText = document.getElementById('status');
      const audioPlayback = document.getElementById('audioPlayback');
      const downloadButton = document.getElementById('download');
      const playAudioButton = document.getElementById('playAudio');

      // Start recording audio
      startButton.onclick = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();
        statusText.innerText = "Recording...";
        audioChunks = [];

        mediaRecorder.ondataavailable = (event) => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          const audioUrl = URL.createObjectURL(audioBlob);

          // Set the audio for playback
          audioPlayback.src = audioUrl;

          // Show the download button and play button after recording
          downloadButton.href = audioUrl;
          downloadButton.style.display = 'inline'; // Show the download button
          playAudioButton.style.display = 'inline'; // Show the Play Audio button

          statusText.innerText = "Recording stopped. You can now play or download the audio.";

          // Add event listener to play the audio when the button is clicked
          playAudioButton.onclick = () => {
            audioPlayback.play();  // Play audio on user interaction
          };
        };
      };

      // Stop recording when the "Stop Recording" button is clicked
      stopButton.onclick = () => {
        mediaRecorder.stop();
        statusText.innerText = "Processing audio...";
      };
    </script>
  </body>
</html>
